<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Team</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 10px;
            background-color: var(--vscode-editor-background); /* Use VS Code's background color */
            color: var(--vscode-editor-foreground);
        }

        form {
            display: flex;
            flex-direction: column;
        }

        textarea,
        input[type="text"],
        input[type="password"],
        input[type="color"],
        select {
            padding: 5px;
            margin-bottom: 5px;
            width: 95%;
            background-color: #D3D3D3;
            color: black;
        }

        .issues {
            color: red;
            float: left;
        }
        
        .cmd {
            width: 100%;
            height: 20px;
            padding: 10px;
        }

        button {
            background-color: transparent;
            border-color: #D3D3D3;
            border-width: 2px;
            border-radius: 4px;
            padding: 6px;
            float: right;
        }

        .icon {
            color: #D3D3D3;
            fill: #D3D3D3;
        }

        .info {
            border-color: #D3D3D3;
            border-width: 2px;
            border-radius: 4px;
            border-style: solid;
            padding: 4px;
            margin: 4px;
        }
    </style>
    <script nonce="${nonce}">
        const vscode = acquireVsCodeApi();
</script>
</head>

<body>
    <span class="cmd">
        <button id="Delete" onclick="delete_setup();" title="Delete"><img class="icon" src="${local_resources}/resources/trash.svg" width="16" height="16" /></button>
        <button id="duplicate" onclick="duplicate_setup();" title="Duplicate"><img class="icon" src="${local_resources}/resources/clone.svg" width="16" height="16" /></button>
    </span>
    <div id="issues" class="issues">
        <!-- dynamic content -->
    </div>
    <h3>Model Member Setup</h3>
    <div id="TeamSetup">
        <form id="team-setup-form" oninput="autoSaveSetup()">
            <input type="hidden" id="id" />

            <label for="name">Name</label>
            <input type="text" id="name" placeholder="Name">

            <label for="color">Color</label>
            <input type="color" id="color" name="color">

            <label for="purpose">Purpose</label>
            <select id="purpose">
                <option value="lead-architect">lead-architect</option>
                <option value="lead-engineer">lead-engineer</option>
                <option value="developer">developer</option>
            </select>

            <label for="model">Model</label>
            <select id="model">
                <option value="anthropic.claude-3-5-sonnet-20240620-v1:0">anthropic.claude-3-5-sonnet-20240620-v1:0 (bedrock)</option>
                <option value="anthropic.claude-3-haiku-20240307-v1:0">anthropic.claude-3-haiku-20240307-v1:0 (bedrock)</option>
                <option value="gpt-4o">gpt-4o (openai)</option>
                <option value="gpt-4-turbo">gpt-4-turbo (openai)</option>
                <option value="gpt-35-turbo">gpt-35-turbo (openai)</option>
            </select>

            <label for="aws_region">AWS Region</label>
            <input type="text" id="aws_region" placeholder="us-east-1">

            <label for="az-deployment">Azure Deployment Name</label>
            <input type="text" id="az-deployment" placeholder="Azure Model Deployment Name">

            <label for="model-endpoint">Azure Endpoint</label>
            <input type="text" id="model-endpoint" placeholder="Model Endpoint-future feature">

            <div id="endpoint-info" class="info">
                "Azure Endpoint" enables the three OpenAI Models (gpt-4o, gpt-4-turbo, gpt-35-turbo) hosted in Azure, leave this field empty to use the models directly from OpenAI. This value is ignored for Bedrock models.
            </div>

            <label for="api-key">API Key</label>
            <input type="password" id="api-key" placeholder="API Key">
            <div id="api-key-info" class="info">
                You can either put your api key value here or you can use a value like this: ENV=ENVIRONMENT_VARIABLE_NAME. Using the second option tells FrogTeam.ai the name of an environment variable. FrogTeam.ai will fetch the environment variable named ENVIRONMENT_VARIABLE_NAME (in this case) and use its value for the api key. Look into how to setup environment variables, it can be tricky to make sure they are setup globally and seen by VS Code. If you do decide to put the raw API Key value in this field it will be stored in the <strong>.vscode/setups.json</strong> file so you may want to exclude that file from source control.
            </div>
        </form>
    </div>

    <script nonce="${nonce}">
        let setup = {};
        
        document.addEventListener('DOMContentLoaded', () => {
            restoreState();
        });

        document.getElementById('team-setup-form').oninput = function () {
            setup = {
                id: document.getElementById('id').value,
                name: document.getElementById('name').value,
                purpose: document.getElementById('purpose').value,
                model: document.getElementById('model').value,
                endpoint: document.getElementById('model-endpoint').value,
                apiKey: document.getElementById('api-key').value,
                color: document.getElementById('color').value,
                icon: setup.icon,
                aws_region: document.getElementById('aws_region').value,
                az_deployment: document.getElementById('az-deployment').value
            };
            vscode.postMessage({ command: 'saveSetup', setup });
            saveState(); // before we post the message!
        };

        window.addEventListener('message', event => {
            const message = event.data;
            switch (message.command) {
                case 'showIssues':
                    displayIssues(message.issues);
                    break;
                case 'load':
                    setup = message.setup;
                    document.getElementById('id').value = setup.id;
                    document.getElementById('name').value = setup.name;
                    document.getElementById('purpose').value = setup.purpose;
                    document.getElementById('model').value = setup.model;
                    document.getElementById('model-endpoint').value = setup.endpoint;
                    document.getElementById('api-key').value = setup.apiKey;
                    document.getElementById('color').value = setup.color;
                    document.getElementById('aws_region').value = setup.aws_region;
                    document.getElementById('az-deployment').value = setup.az_deployment;
                    saveState();
                    break;
                }
        });

        function restoreState() {
            const state = vscode.getState();
            setup = state;
            document.getElementById('id').value = state.id;
            document.getElementById('name').value = state.name;
            document.getElementById('purpose').value = state.purpose;
            document.getElementById('model').value = state.model;
            document.getElementById('model-endpoint').value = state.endpoint;
            document.getElementById('api-key').value = state.apiKey;
            document.getElementById('color').value = state.color;
            document.getElementById('aws_region').value = state.aws_region;
            document.getElementById('az-deployment').value = state.az_deployment;
        };

        function saveState() {
            const state = {
                id: setup.id,
                name: setup.name,
                purpose: setup.purpose,
                model: setup.model,
                endpoint: setup.endpoint,
                apiKey: setup.apiKey,
                color: setup.color,
                icon: setup.icon,
                aws_region: setup.aws_region,
                az_deployment: setup.az_deployment
            };
            vscode.setState(state);
        };

        function displayIssues(issues) {
            const issueList = document.getElementById('issues');
            issueList.innerHTML = '';
            if(issues.length > 0) {
                const header = document.createElement('span');
                header.innerText = "Missing Prompts"
                issueList.appendChild(header)
                issues.forEach((issue, index) => {
                    const listItem = document.createElement('li');
                    listItem.className = 'issue-item';
                    listItem.innerHTML = "category: " + issue.category + " role: " + issue.role;
                    issueList.appendChild(listItem);
                });
            }
        };

        function delete_setup() {
            vscode.postMessage({ command: 'deleteSetup', setup });
        };

        function duplicate_setup() {
            setup.id = generateUniqueId();
            saveState();
            vscode.postMessage({ command: 'saveSetup', setup });
        };

        function generateUniqueId() {
            return 'xxxx-xxxx-4xxx-yxxx-xxxx-xxxx-xxxx'.replace(/[xy]/g, function(c) {
                const r = Math.random() * 16 | 0;
                const v = c === 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        };

        function addSetup() {
            const id = generateUniqueId(), name = "", purpose = "", model = "", endpoint = "", apiKey = "", color = "#CCAA99", icon = "", az_deployment = ""
            setup = { id, name, purpose, model, endpoint, apiKey, color, icon, az_deployment };
        };

    </script>
</body>

</html>           